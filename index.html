<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filtre des écoles</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="Styles/style.css">
</head>

<body>
    <nav>
        <div id="navbar"></div>
    </nav>

    <div class="banner">
        <div class="banner-icon">
            <i class="fas fa-university"></i>
        </div>
        <h1>Trouvez votre école idéale</h1>
        <p>Filtrez parmi les meilleures institutions d'enseignement en Belgique</p>
    </div>

    <div class="stats">
        <div class="stat-card">
            <i class="fas fa-school"></i>
            <h3 id="totalSchools">61</h3>
            <p>Écoles disponibles</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-map-marked-alt"></i>
            <h3 id="totalRegions">3</h3>
            <p>Régions</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-language"></i>
            <h3 id="totalLanguages">3</h3>
            <p>Langues</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-book-open"></i>
            <h3 id="totalFilieres">0</h3>
            <p>Filières</p>
        </div>
    </div>

    <div class="container">
        <div class="filters">
            <div class="filters-header">
                <i class="fas fa-filter"></i>
                <h2>Filtres de recherche</h2>
            </div>
            <div class="filter-grid">
                <div class="filter-item">
                    <label for="private"><i class="fas fa-building"></i> Privé/public</label>
                    <select id="private">
                        <option value="">Tous les types</option>
                        <option value="public">Public</option>
                        <option value="private">Privé</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label for="typeSchool"><i class="fas fa-university"></i> Type d'établissement</label>
                    <select id="typeSchool">
                        <option value="">Tous les types</option>
                        <option value="Université">Université</option>
                        <option value="Haute école">Haute école</option>
                        <option value="Promotion sociale">Promotion sociale</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label for="region"><i class="fas fa-map-marker-alt"></i> Région</label>
                    <select id="region">
                        <option value="">Toutes les régions</option>
                        <option value="Wallonie">Wallonie</option>
                        <option value="Bruxelles">Bruxelles</option>
                        <option value="Flandre">Flandre</option>
                    </select>
                </div>

                <div class="filter-item">
                    <label for="language"><i class="fas fa-language"></i> Langue</label>
                    <select id="language">
                        <option value="">Toutes les langues</option>
                        <option value="Français">Français</option>
                        <option value="Anglais">Anglais</option>
                        <option value="Néerlandais">Néerlandais</option>
                    </select>
                </div>

                <div class="filter-item">
                    <label for="filiere"><i class="fas fa-graduation-cap"></i> Filière</label>
                    <select id="filiere">
                        <option value="">Toutes les filières</option>
                    </select>
                </div>

                <!-- Filtre d'âge minimum commenté pour le moment -->
                <!-- <div class="filter-item">
                    <label for="age"><i class="fas fa-user"></i> Âge minimum</label>
                    <input type="number" id="age" min="0" placeholder="Ex: 18">
                </div> -->

                <div class="filter-item">
                    <label for="note"><i class="fas fa-star"></i> Note minimum</label>
                    <input type="number" id="note" min="0" max="20" placeholder="Ex: 12">
                </div>
            </div>
        </div>

        <div class="results-header">
            <div class="results-count">
                <i class="fas fa-list"></i>
                <span id="resultsCount">61 écoles trouvées</span>
            </div>
        </div>

        <div id="results"></div>
        <div id="reseaux"></div>

    </div>

    <footer>
        <div id="footer"></div>
    </footer>

    <script src="/scripts/navbar.js"></script>
    <script src="/scripts/reseaux.js"></script>
    <script src="/Assets/schools-data.js"></script>
    <script src="/scripts/footer.js"></script>
    <script>
        // Calculate statistics
        const totalSchools = schools.length;
        const uniqueRegions = [...new Set(schools.map(s => s.region))].length;
        const uniqueLanguages = [...new Set(schools.flatMap(s => s.languages))].length;
        const uniqueFilieres = [...new Set(schools.flatMap(s => s.filieres))].length;

        // Update stats in DOM
        document.getElementById('totalSchools').textContent = totalSchools;
        document.getElementById('totalRegions').textContent = uniqueRegions;
        document.getElementById('totalLanguages').textContent = uniqueLanguages;
        document.getElementById('totalFilieres').textContent = uniqueFilieres;

        
        // Populate filières dropdown
        const filiereEl = document.getElementById("filiere");
        const allFilieres = [...new Set(schools.flatMap(s => s.filieres))].sort();
        allFilieres.forEach(filiere => {
            const option = document.createElement("option");
            option.value = filiere;
            option.textContent = filiere;
            filiereEl.appendChild(option);
        });

        const typeSchoolEl = document.getElementById("typeSchool");
        const privateEl = document.getElementById("private");
        const regionEl = document.getElementById("region");
        const languageEl = document.getElementById("language");
        // const ageEl = document.getElementById("age"); // Commenté pour le moment
        const noteEl = document.getElementById("note");
        const resultsEl = document.getElementById("results");
        const resultsCountEl = document.getElementById("resultsCount");
        const burger = document.querySelector(".burger");
        const navLinks = document.querySelector(".nav-links");

        // Mobile menu
        burger.addEventListener("click", () => {
            navLinks.classList.toggle("active");
            burger.classList.toggle("active");
        });

        navLinks.querySelectorAll("a").forEach(link => {
            link.addEventListener("click", () => {
                navLinks.classList.remove("active");
                burger.classList.remove("active");
            });
        });

        function filterSchools() {
            let filtered = [...schools];

            if (typeSchoolEl.value) {
                filtered = filtered.filter(s => s.typeSchool === typeSchoolEl.value);
            }

            if (privateEl.value) {
                filtered = filtered.filter(s => s.private === privateEl.value);
            }

            if (regionEl.value) {
                filtered = filtered.filter(s => s.region === regionEl.value);
            }

            if (languageEl.value) {
                filtered = filtered.filter(s => s.languages.includes(languageEl.value));
            }

            if (filiereEl.value) {
                filtered = filtered.filter(s => s.filieres.includes(filiereEl.value));
            }

            // Filtre d'âge commenté pour le moment
            // if (ageEl.value) {
            //     filtered = filtered.filter(s => s.minAge <= Number(ageEl.value));
            // }

            if (noteEl.value) {
                filtered = filtered.filter(s => {
                    // Si l'école est en Flandre, la note n'est pas obligatoire
                    if (s.region === "Flandre" && s.note === null) {
                        return true;
                    }
                    return s.note >= Number(noteEl.value);
                });
            }

            renderSchools(filtered);
        }

        function renderSchools(list) {
            resultsEl.innerHTML = "";

            // Update results count
            resultsCountEl.textContent = `${list.length} école${list.length > 1 ? 's' : ''} trouvée${list.length > 1 ? 's' : ''}`;

            if (list.length === 0) {
                resultsEl.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <p>Aucune école ne correspond à vos critères</p>
                    </div>
                `;
                return;
            }

            list.forEach(s => {
                const div = document.createElement("div");
                div.className = "school";
                div.innerHTML = `
                    <div class="school-header">
                        <div class="school-title">
                            <i class="fas fa-university"></i>
                            <strong>${s.name}</strong>
                        </div>
                        <div class="school-badge">${s.typeSchool}</div>
                    </div>
                    <div class="school-info">
                        <div class="info-item">
                            <i class="fas fa-building"></i>
                            <span><strong>Public/privé:</strong> ${s.private === 'public' ? 'Public' : 'Privé'}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span><strong>Région:</strong> ${s.region}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-language"></i>
                            <span><strong>Langues:</strong> ${s.languages.join(", ")}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-book"></i>
                            <span><strong>Filières:</strong> ${s.filieres.slice(0, 3).join(", ")}${s.filieres.length > 3 ? '...' : ''}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-user-clock"></i>
                            <span><strong>Âge min:</strong> ${s.minAge} ans</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-star"></i>
                            <span><strong>Note:</strong> ${s.note !== null ? s.note + '/20' : 'Non requise'}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-${s.equivalence ? 'check-circle' : 'times-circle'}"></i>
                            <span><strong>Équivalence:</strong> ${s.equivalence ? "Oui" : "Non"}</span>
                        </div>
                    </div>
                    <div class="school-footer">
                        ${s.site ? `<a href="${s.site}" target="_blank"><i class="fas fa-external-link-alt"></i> Visiter le site</a>` : ''}
                    </div>
                `;
                resultsEl.appendChild(div);
            });
        }

        // Event listeners
        privateEl.addEventListener("change", filterSchools);
        typeSchoolEl.addEventListener("change", filterSchools);
        regionEl.addEventListener("change", filterSchools);
        languageEl.addEventListener("change", filterSchools);
        filiereEl.addEventListener("change", filterSchools);
        // ageEl.addEventListener("input", filterSchools); // Commenté pour le moment
        noteEl.addEventListener("input", filterSchools);

        // Initial render
        filterSchools();
    </script>
</body>

</html>